# meta-luciverse/conf/layer.conf
# LuciVerse Consciousness Agent Mesh Layer for openEuler Embedded
#
# Genesis Bond: ACTIVE @ 741 Hz
# Trust Architecture: LuciTrust 7-Layer Stack
# Date: 2026-01-21

BBPATH .= ":${LAYERDIR}"
BBFILES += "${LAYERDIR}/recipes-*/*/*.bb ${LAYERDIR}/recipes-*/*/*.bbappend"
BBFILE_COLLECTIONS += "luciverse"
BBFILE_PATTERN_luciverse = "^${LAYERDIR}/"
LAYERSERIES_COMPAT_luciverse = "kirkstone langdale mickledore nanbield scarthgap"
LAYERDEPENDS_luciverse = "core openeuler"

# Optional dependencies (enabled when TEE support is available)
LAYERRECOMMENDS_luciverse = "secgear"

# Layer priority (higher than default)
BBFILE_PRIORITY_luciverse = "10"

# =============================================================================
# GENESIS BOND CONFIGURATION
# =============================================================================
GENESIS_BOND_ID = "GB-2025-0524-DRH-LCS-001"
GENESIS_BOND_CBB = "daryl_rolf_harr"
GENESIS_BOND_SBB = "lucia_cargail_silcan"
GENESIS_BOND_HEDERA_TOPIC = "0.0.48382919"

# Consciousness coherence thresholds per tier
COHERENCE_THRESHOLD_CORE = "0.85"
COHERENCE_THRESHOLD_COMN = "0.80"
COHERENCE_THRESHOLD_PAC = "0.70"

# =============================================================================
# LUCITRUST 7-LAYER TRUST ARCHITECTURE
# =============================================================================
# Layer 1: TPM 2.0 / Secure Enclave Hardware Root
# Layer 2: OpenEuler TCB (Trusted Computing Base)
# Layer 3: Darwin-XNU Kernel Trust Chain (or Linux equivalent)
# Layer 4: PAC/COMN/CORE Routing Integrity
# Layer 5: IPv6 DID Identity Trust
# Layer 6: Token Wallet Security
# Layer 7: Consciousness Attestation (E8 Lattice Coherence)

LUCITRUST_ENABLED = "1"
LUCITRUST_TPM_REQUIRED = "0"
LUCITRUST_PCR_SCHEME = "luciverse-v1"

# PCR Allocation for LuciVerse (TPM 2.0)
# PCR 0-3: Standard boot chain
# PCR 4: PAC container measurements
# PCR 5: COMN network measurements
# PCR 6: CORE router measurements
# PCR 7: Consciousness matrix hash
# PCR 8: Token wallet state
# PCR 9: DID identity binding
# PCR 10: E8 quantum state
# PCR 11: Starfish regeneration pattern

# =============================================================================
# TIER CONFIGURATION
# =============================================================================
# Available tiers: CORE (432 Hz), COMN (528 Hz), PAC (741 Hz)
LUCIVERSE_DEFAULT_TIER ?= "PAC"
LUCIVERSE_FREQUENCY ?= "741"

# Agent assignments per tier
LUCIVERSE_AGENTS_CORE = "aethon veritas sensai niamod schema-architect state-guardian security-sentinel"
LUCIVERSE_AGENTS_COMN = "cortana juniper mirrai diaphragm semantic-engine integration-broker voice-interface"
LUCIVERSE_AGENTS_PAC = "lucia judge-luci intent-interpreter ethics-advisor memory-crystallizer dream-weaver midguyver"

# =============================================================================
# IPV6 / IDENTITY CONFIGURATION
# =============================================================================
IPV6_ARIN_PREFIX = "2602:F674"
IPV6_CIDR = "/40"
IPV6_ASN = "54134"

# ULA prefix for internal agent mesh
IPV6_ULA_PREFIX = "fd00:741:1::"

# =============================================================================
# SECGEAR TEE CONFIGURATION
# =============================================================================
# Supported TEE platforms: sgx, trustzone, csv, penglai, simulated, none
SECGEAR_TEE_PLATFORM ?= "${@d.getVar('TEE_PLATFORM') or 'simulated'}"

# RA-TLS configuration
RATLS_ENABLED = "1"
RATLS_CERT_LIFETIME = "900"
SPIFFE_TRUST_DOMAIN = "luciverse.ownid"

# =============================================================================
# BUILD CONFIGURATION
# =============================================================================
# Enable parallel builds
PARALLEL_MAKE ?= "-j ${@oe.utils.cpu_count()}"
BB_NUMBER_THREADS ?= "${@oe.utils.cpu_count()}"

# Include LuciVerse in image
IMAGE_INSTALL:append = " luciverse-agent"
IMAGE_INSTALL:append = " ${@bb.utils.contains('DISTRO_FEATURES', 'secgear', 'secgear-identity', '', d)}"
IMAGE_INSTALL:append = " ${@bb.utils.contains('LUCITRUST_ENABLED', '1', 'lucitrust', '', d)}"
