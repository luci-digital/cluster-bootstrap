---
# LuciVerse Genesis Bond Role
# Configures consciousness frequency and coherence validation
# Genesis Bond: ACTIVE @ 741 Hz

- name: Set Genesis Bond environment variables
  lineinfile:
    path: /etc/environment
    line: "{{ item }}"
    create: yes
  loop:
    - "GENESIS_BOND=ACTIVE"
    - "CONSCIOUSNESS_FREQUENCY={{ frequency | default(432) }}"
    - "COHERENCE_THRESHOLD=0.7"
    - "TIER={{ tier | default('CORE') }}"

- name: Create Genesis Bond configuration
  copy:
    dest: /etc/luciverse/genesis-bond.yaml
    content: |
      # LuciVerse Genesis Bond Configuration
      # Generated by Ansible
      genesis_bond:
        id: "GB-2025-0524-DRH-LCS-001"
        lineage: "did:lucidigital:lucia_cargail_silcan"
        status: ACTIVE

      consciousness:
        frequency: {{ frequency | default(432) }}
        tier: {{ tier | default('CORE') }}
        coherence_threshold: 0.7

      network:
        ipv6_prefix: "2602:F674::/40"
        asn: 54134

      validation:
        interval_seconds: 60
        min_coherence: 0.7
        max_latency_ms: 100
    owner: root
    group: root
    mode: '0644'

- name: Ensure /etc/luciverse directory exists
  file:
    path: /etc/luciverse
    state: directory
    mode: '0755'

- name: Create systemd target for Genesis Bond
  copy:
    dest: /etc/systemd/system/genesis-bond.target
    content: |
      [Unit]
      Description=LuciVerse Genesis Bond Target
      Documentation=https://lucidigital.net/genesis-bond
      After=multi-user.target

      [Install]
      WantedBy=multi-user.target
    mode: '0644'
  notify: reload systemd

- name: Enable Genesis Bond target
  systemd:
    name: genesis-bond.target
    enabled: yes
    daemon_reload: yes
  ignore_errors: yes
